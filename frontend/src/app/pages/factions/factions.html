<div class="card">
  <div class="toolbar">
    <h2 class="m-0">Factions</h2>

    <span class="p-input-icon-left ml-auto">
      <i class="pi pi-search"></i>
      <input
        pInputText
        type="text"
        placeholder="Search factions..."
        [(ngModel)]="globalFilter"
        (input)="dt.filterGlobal(globalFilter, 'contains')"
      />
    </span>

    <button pButton type="button" icon="pi pi-download" label="CSV" class="p-button-sm"
            (click)="dt.exportCSV()"></button>
  </div>

  <p-table
    #dt
    [value]="rows"
    [paginator]="true"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    sortMode="multiple"
    responsiveLayout="scroll"
    [globalFilterFields]="['displayName','code','lordName','banner','capitalWaypoint']"
    [loading]="loading"
    dataKey="code"
  >
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="displayName">Name <p-sortIcon field="displayName" /></th>
        <th pSortableColumn="code">Code <p-sortIcon field="code" /></th>
        <th pSortableColumn="banner">Banner <p-sortIcon field="banner" /></th>
        <th pSortableColumn="capitalWaypoint">Capital <p-sortIcon field="capitalWaypoint" /></th>
        <th pSortableColumn="lordName">Lord <p-sortIcon field="lordName" /></th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-f>
      <tr>
        <td><span class="font-medium">{{ f.displayName }}</span></td>
        <td><span class="pi pi-hashtag mr-1" pTooltip="Code"></span>{{ f.code }}</td>
        <td>
          <p-tag *ngIf="f.banner; else noBanner" [value]="f.banner!" severity="info"></p-tag>
          <ng-template #noBanner><span class="text-500">—</span></ng-template>
        </td>
        <td>{{ f.capitalWaypoint || '—' }}</td>
        <td>{{ f.lordName || '—' }}</td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr><td colspan="5">No factions found.</td></tr>
    </ng-template>

    <ng-template pTemplate="loadingbody">
      <tr>
        <td colspan="5" class="center">
          <p-progressSpinner styleClass="w-2rem h-2rem"></p-progressSpinner>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
